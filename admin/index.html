<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OMMAE Admin | Mohawk Medibles</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #0f0f1a;
            color: #e0e0e0;
            min-height: 100vh;
        }
        .header { display: flex; justify-content: space-between; align-items: center; padding: 16px 24px; background: #1a1a2e; border-bottom: 1px solid #2d2d44; }
        .logo { color: #00d9a5; font-size: 24px; font-weight: bold; }
        .logo span { color: #666; font-size: 14px; font-weight: normal; margin-left: 8px; }
        .header-actions { display: flex; gap: 12px; align-items: center; }
        .brand-select { background: #2d2d44; border: 1px solid #3d3d5c; color: #e0e0e0; padding: 8px 16px; border-radius: 6px; cursor: pointer; }
        .btn-primary { background: #00d9a5; color: #0f0f1a; border: none; padding: 10px 20px; border-radius: 6px; font-weight: 600; cursor: pointer; transition: all 0.2s; }
        .btn-primary:hover { background: #00b388; }
        .btn-primary:disabled { background: #444; cursor: not-allowed; }
        .tabs { display: flex; gap: 0; background: #1a1a2e; border-bottom: 1px solid #2d2d44; }
        .tab { padding: 14px 24px; color: #888; cursor: pointer; border-bottom: 2px solid transparent; transition: all 0.2s; }
        .tab:hover { color: #00d9a5; }
        .tab.active { color: #00d9a5; border-bottom-color: #00d9a5; }
        .tab .count { background: #2d2d44; padding: 2px 8px; border-radius: 10px; font-size: 12px; margin-left: 6px; }
        .main { padding: 24px; }
        .video-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)); gap: 20px; }
        .video-card { background: #1a1a2e; border-radius: 12px; overflow: hidden; border: 1px solid #2d2d44; transition: all 0.2s; }
        .video-card:hover { border-color: #00d9a5; transform: translateY(-2px); }
        .video-preview { position: relative; width: 100%; aspect-ratio: 16/9; background: #0a0a14; }
        .video-preview video { width: 100%; height: 100%; object-fit: cover; }
        .video-info { padding: 16px; }
        .video-topic { font-size: 14px; font-weight: 600; margin-bottom: 8px; }
        .video-meta { font-size: 12px; color: #666; }
        .video-actions { display: flex; gap: 8px; padding: 12px 16px; border-top: 1px solid #2d2d44; }
        .btn-small { flex: 1; padding: 8px 12px; border: none; border-radius: 4px; font-size: 12px; cursor: pointer; transition: all 0.2s; }
        .btn-approve { background: #00d9a5; color: #0f0f1a; }
        .btn-reject { background: #ff4757; color: white; }
        .btn-post { background: #5352ed; color: white; }
        .empty-state { text-align: center; padding: 60px 20px; color: #666; }
        .empty-state h3 { margin-bottom: 8px; color: #888; }
        .status-badge { display: inline-block; padding: 4px 10px; border-radius: 12px; font-size: 11px; font-weight: 600; text-transform: uppercase; }
        .status-staged { background: #ffa502; color: #0f0f1a; }
        .status-approved { background: #00d9a5; color: #0f0f1a; }
        .status-posted { background: #5352ed; color: white; }
        .spinner { width: 20px; height: 20px; border: 2px solid #333; border-top-color: #00d9a5; border-radius: 50%; animation: spin 0.8s linear infinite; display: inline-block; margin-right: 8px; }
        @keyframes spin { to { transform: rotate(360deg); } }
        .toast { position: fixed; bottom: 24px; right: 24px; background: #1a1a2e; border: 1px solid #00d9a5; padding: 16px 24px; border-radius: 8px; display: none; z-index: 1000; }
        .toast.show { display: block; animation: slideIn 0.3s ease; }
        @keyframes slideIn { from { transform: translateX(100px); opacity: 0; } }
        .footer { text-align: center; padding: 20px; color: #444; font-size: 12px; border-top: 1px solid #1a1a2e; }
    </style>
</head>
<body>
    <header class="header">
        <div class="logo">OMMAE <span>v0.1</span></div>
        <div class="header-actions">
            <select class="brand-select" id="brandSelect"><option value="mohawk_medibles">Mohawk Medibles</option></select>
            <button class="btn-primary" id="newVideoBtn" onclick="generateVideo()">+ New Video</button>
        </div>
    </header>
    <nav class="tabs">
        <div class="tab active" data-tab="staging" onclick="switchTab('staging')">Staging <span class="count" id="stagingCount">0</span></div>
        <div class="tab" data-tab="approved" onclick="switchTab('approved')">Approved <span class="count" id="approvedCount">0</span></div>
        <div class="tab" data-tab="logs" onclick="switchTab('logs')">Logs</div>
    </nav>
    <main class="main"><div id="content"><div class="empty-state"><h3>No videos in staging</h3><p>Click "+ New Video" to generate content</p></div></div></main>
    <footer class="footer">OMMAE v0.1 | Self-healing content empire | Built for Mohawk Medibles</footer>
    <div class="toast" id="toast"></div>
    <script>
        const API_URL = 'https://ommae-api-244799968350.us-central1.run.app';
        let currentTab = 'staging', videos = [], isGenerating = false;
        document.addEventListener('DOMContentLoaded', () => { fetchVideos(); setInterval(fetchVideos, 10000); });
        async function fetchVideos() { try { const r = await fetch(API_URL + '?action=videos'); const d = await r.json(); if (d.success) { videos = d.videos || []; updateUI(); } } catch (e) { console.error('Failed:', e); } }
        async function generateVideo() { if (isGenerating) return; const btn = document.getElementById('newVideoBtn'); isGenerating = true; btn.disabled = true; btn.innerHTML = '<span class="spinner"></span>Generating...'; try { const r = await fetch(API_URL, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ action: 'generate-video', topic: 'Indigenous Cannabis Wellness' }) }); const d = await r.json(); if (d.success) { showToast('Video generated!'); await fetchVideos(); } else { showToast('Failed: ' + (d.error || 'Unknown')); } } catch (e) { showToast('Error'); } finally { isGenerating = false; btn.disabled = false; btn.innerHTML = '+ New Video'; } }
        async function updateVideoStatus(id, status) { try { const r = await fetch(API_URL, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ action: 'video', video_id: id, status }) }); const d = await r.json(); if (d.success) { showToast('Video ' + status + '!'); await fetchVideos(); } } catch (e) { console.error(e); } }
        function switchTab(tab) { currentTab = tab; document.querySelectorAll('.tab').forEach(t => t.classList.remove('active')); document.querySelector('[data-tab="' + tab + '"]').classList.add('active'); updateUI(); }
        function updateUI() { const content = document.getElementById('content'); let filtered = videos; if (currentTab === 'staging') filtered = videos.filter(v => v.status === 'staged'); else if (currentTab === 'approved') filtered = videos.filter(v => v.status === 'approved' || v.status === 'posted'); document.getElementById('stagingCount').textContent = videos.filter(v => v.status === 'staged').length; document.getElementById('approvedCount').textContent = videos.filter(v => v.status === 'approved' || v.status === 'posted').length; if (currentTab === 'logs') { content.innerHTML = '<div class="empty-state"><h3>Activity Logs</h3><p>Coming soon...</p></div>'; return; } if (filtered.length === 0) { content.innerHTML = '<div class="empty-state"><h3>No videos in ' + currentTab + '</h3><p>' + (currentTab === 'staging' ? 'Click "+ New Video"' : 'Approve from staging') + '</p></div>'; return; } content.innerHTML = '<div class="video-grid">' + filtered.map(v => renderVideoCard(v)).join('') + '</div>'; }
        function renderVideoCard(v) { return '<div class="video-card"><div class="video-preview"><video controls preload="metadata" poster="' + v.thumbnail + '"><source src="' + v.video_url + '" type="video/mp4"></video></div><div class="video-info"><div class="video-topic">' + v.topic + '</div><div class="video-meta"><span class="status-badge status-' + v.status + '">' + v.status + '</span> • ' + v.duration + ' • ' + formatDate(v.created_at) + '</div></div><div class="video-actions">' + (v.status === 'staged' ? '<button class="btn-small btn-approve" onclick="updateVideoStatus(\'' + v.id + '\', \'approved\')">Approve</button><button class="btn-small btn-reject" onclick="updateVideoStatus(\'' + v.id + '\', \'rejected\')">Reject</button>' : '') + (v.status === 'approved' ? '<button class="btn-small btn-post" onclick="postVideo(\'' + v.id + '\')">POST NOW</button>' : '') + (v.status === 'posted' ? '<button class="btn-small" style="background:#333;color:#888" disabled>Posted</button>' : '') + '</div></div>'; }
        async function postVideo(id) { showToast('Posting to Instagram, TikTok, YouTube...'); setTimeout(async () => { await updateVideoStatus(id, 'posted'); showToast('Posted to 3 platforms!'); }, 2000); }
        function formatDate(iso) { const d = new Date(iso), diff = (new Date() - d) / 1000; if (diff < 60) return 'Just now'; if (diff < 3600) return Math.floor(diff/60) + 'm ago'; if (diff < 86400) return Math.floor(diff/3600) + 'h ago'; return d.toLocaleDateString(); }
        function showToast(msg) { const t = document.getElementById('toast'); t.textContent = msg; t.classList.add('show'); setTimeout(() => t.classList.remove('show'), 4000); }
    </script>
</body>
</html>
